<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <meta name="author" content="ncfl" />
  <meta name="description" content="" />
  
  
  <title>
    
      kafka的安装和使用 
      
      
      |
    
     ncfl
  </title>

  
    <link rel="apple-touch-icon" href="/images/snow.png">
    <link rel="icon" href="/images/snow.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img no-lazy src="/images/snow.png" alt="">
      
    </a>
    <div class="nickname"><a href="/"></a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">首页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">kafka的安装和使用</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
          2018-11-01 19:37:00
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="标签"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/kafka/" title="kafka">
                    #kafka
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h2 id="1、安装启动kafka"><a href="#1、安装启动kafka" class="headerlink" title="1、安装启动kafka"></a><strong>1、安装启动kafka</strong></h2><p>kafka几乎是开箱即用的。<br>下载地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://kafka.apache.org/downloads">http://kafka.apache.org/downloads</a></p>
<p>根据需要，修改配置文件<code>server.properties</code><br>主要修改zookeeper的地址和logs地址，如果zookeeper在本地，则可以不做任何修改。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">num.network.threads</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">num.io.threads</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">socket.send.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="attr">socket.receive.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="attr">socket.request.max.bytes</span>=<span class="string">104857600</span></span><br><span class="line"><span class="attr">log.dirs</span>=<span class="string">/tmp/kafka-logs</span></span><br><span class="line"><span class="attr">num.partitions</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">num.recovery.threads.per.data.dir</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">offsets.topic.replication.factor</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transaction.state.log.replication.factor</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transaction.state.log.min.isr</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">log.retention.hours</span>=<span class="string">168</span></span><br><span class="line"><span class="attr">log.segment.bytes</span>=<span class="string">1073741824</span></span><br><span class="line"><span class="attr">log.retention.check.interval.ms</span>=<span class="string">300000</span></span><br><span class="line"><span class="attr">zookeeper.connect</span>=<span class="string">localhost:2181</span></span><br><span class="line"><span class="attr">zookeeper.connection.timeout.ms</span>=<span class="string">6000</span></span><br><span class="line"><span class="attr">group.initial.rebalance.delay.ms</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<p>启动kafka：</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-server-start.sh .&#x2F;config&#x2F;server.properties</p>
</blockquote>
<p>后台运行kafka</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-server-start.sh .&#x2F;config&#x2F;server.properties 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;<br>.&#x2F;bin&#x2F;kafka-server-start.sh .&#x2F;config&#x2F;server.properties &amp;<br>.&#x2F;bin&#x2F;kafka-server-start.sh -daemon .&#x2F;config&#x2F;server.properties </p>
</blockquote>
<h2 id="2、命令行"><a href="#2、命令行" class="headerlink" title="2、命令行"></a><strong>2、命令行</strong></h2><h3 id="主题信息"><a href="#主题信息" class="headerlink" title="主题信息"></a>主题信息</h3><p>列出topic</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181 –list</p>
</blockquote>
<p>创建topic</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 1 –partitions 1 –topic Demo1 [–if-not-exists]</p>
</blockquote>
<p>描述topic</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –describe –zookeeper localhost:2181 –topic Demo1</p>
</blockquote>
<p>修改topic</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –alter –zookeeper localhost:2181 –partitions 11 –topic Demo1</p>
</blockquote>
<p>删除topic</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –alter –zookeeper localhost:2181 –partitions 11 –topic Demo1</p>
</blockquote>
<p>控制台生产者</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-console-producer.sh –broker-list localhost:9092 –topic Demo1</p>
</blockquote>
<p>控制台消费者</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-console-consumer.sh –bootstrap-server localhost:9092 –from-beginning –topic Demo1</p>
</blockquote>
<p>增加分区</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181&#x2F;kafka –alter –topic topic-config –partitions 3 [–if-exists]</p>
</blockquote>
<p>列出集群中所有的主题</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181 –list</p>
</blockquote>
<p>列出集群中所有的主题和所有详细信息</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181 –describe</p>
</blockquote>
<p>列出集群中不同步副本的分区</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181 –describe –under-replicated-partitions</p>
</blockquote>
<p>列出集群中不可用的分区，即是无首领的分区</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper localhost:2181 –describe –unavailable-partitions</p>
</blockquote>
<p>生产者和消费者同时启动着的时候，在producer上发送消息就会被consumer接收到。</p>
<h3 id="消费者信息："><a href="#消费者信息：" class="headerlink" title="消费者信息："></a>消费者信息：</h3><p>查看消费群组列表</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-consumer-groups.sh –bootstrap-server ip:9092 –list</p>
</blockquote>
<p>查看具体的某个消费群组的具体信息</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-consumer-groups.sh –bootstrap-server ip:9092 –descirbe –group group1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TOPIC               正在被读取的主题名</span><br><span class="line">PARTITION           正在被读取的分区ID</span><br><span class="line">CURRENT-OFFSET      消费者最近提交的偏移量，即是消费者在分区的偏移量</span><br><span class="line">LOG-END-OFFSET      当前高水位偏移量， 也就是最近一个被读取消息的偏移量，同时也是最近一个被提交到集群的偏移量</span><br><span class="line">LAG                 消费者的CURRENT-OFFSET和broker的LOG-END-OFFSET 之间的差距</span><br><span class="line">CONSUMER-ID         消费者ID</span><br><span class="line">HOST                消费者的ip地址</span><br><span class="line">CLIENT-ID           client-id</span><br></pre></td></tr></table></figure>

<h3 id="动态配置变更："><a href="#动态配置变更：" class="headerlink" title="动态配置变更："></a>动态配置变更：</h3><p>主题配置信息变更</p>
<blockquote>
<p>kafka-configs.sh –zookeeper localhost:2181 –alert –entity-type topics –entity-name <topic-name> –add-config <key>&#x3D;<value> [,key&#x3D;value…]</p>
</blockquote>
<p>其中<code>key</code> <code>value</code>可配置项如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cleanup.policy</td>
<td>如果被设置为 compact,只有最新包含了指定key的消息会被保留下来(压缩日志),其他的被丢弃掉</td>
</tr>
<tr>
<td>compression.type</td>
<td>broker在将消息批次写入磁盘时所使用的压缩类型,日前支持“gzip”、“ snappy”和“lz4</td>
</tr>
<tr>
<td>delete.retention.ms</td>
<td>被标识为待删除的数据能够保留多久,以ms为单位。该参数只对压缩日志类型的主题有效</td>
</tr>
<tr>
<td>file.delete.delay.ms</td>
<td>从磁盘上删除日志片段和索引之前可以等待多长时间,以ms为单位</td>
</tr>
<tr>
<td>flush.messages</td>
<td>需要收到多少个消息才能将它们刷新到磁盘</td>
</tr>
<tr>
<td>flush.ms</td>
<td>在将消息刷新到磁盘之前可以等待多长时间,以ms为单位</td>
</tr>
<tr>
<td>inde.interval.by</td>
<td>日志片段的两个索引之间能够容纳的消息字节数</td>
</tr>
<tr>
<td>max.message.by</td>
<td>最大消息字节数</td>
</tr>
<tr>
<td>message.format.version</td>
<td>broker将消息写入磁盘时所使用的消息格式,必须是有效的AP版本号(比如“0.100”)</td>
</tr>
<tr>
<td>message.timestamp.difference.max.ms</td>
<td>消息自带的时间戳和 broker收到消息时的时间戳之间最大的差值,以ms为单位。该参数只在messsage. timestamp.type被设为 Create-time时有效</td>
</tr>
<tr>
<td>message.timestamp.type</td>
<td>在将消息写入磁盘时使用哪一种时间戳。目前支持两种值,其中CreateTime指客户端指定的时间戳,而 Log Append Time指消息被写入分区时的时间戳</td>
</tr>
<tr>
<td>min.cleanable.dirty.ratio</td>
<td>日志压缩器压缩分区的频率,使用未压缩日志片段数与总日志分段数之间的比例来表示。该参数只对压缩日志类型的主题有效</td>
</tr>
<tr>
<td>min.insync.replicas</td>
<td>可用分区的最少同步副本</td>
</tr>
<tr>
<td>preallocate</td>
<td>如果被设为true,需要为新的日志片段预分配空间</td>
</tr>
<tr>
<td>retention.bytes</td>
<td>主题能够保留的消息量,以字节为单位</td>
</tr>
<tr>
<td>retention.ms</td>
<td>主题需要保留消息多长时间,以ms为单位</td>
</tr>
<tr>
<td>egment.bytes</td>
<td>日志片段的消息字节数</td>
</tr>
<tr>
<td>segmentindex.bytes</td>
<td>单个日志片段的最大索引字节数</td>
</tr>
<tr>
<td>segment.jitter.ms</td>
<td>滚动日志片断时,在 segment.ns基础上增加的随机毫秒数日志片段多长时间滚动一次,以ms为单位</td>
</tr>
<tr>
<td>unclean.leader.election.enable</td>
<td>如果被设为true,不彻底的首领选择无效</td>
</tr>
</tbody></table>
<p>查看被覆盖的配置</p>
<blockquote>
<p>kafka-configs.sh –zookeeper localhost:2181 –alert –entity-type topics –entity-name <topic-name> </p>
</blockquote>
<p>移除被覆盖的配置</p>
<blockquote>
<p>kafka-configs.sh –zookeeper localhost:2181 –alert –entity-type topics –entity-name <topic-name> –delete-config retention.ms</p>
</blockquote>
<h3 id="解析日志文件："><a href="#解析日志文件：" class="headerlink" title="解析日志文件："></a>解析日志文件：</h3><p>解析日志文件</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegment –files 00000000000052368601.log</p>
</blockquote>
<p>解析日志文件，并打印数据内容</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegment –files 00000000000052368601.log –print-data-log</p>
</blockquote>
<p>解析索引文件</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegment –files 00000000000052368601.index</p>
</blockquote>
<p>解析索引文件，并检查无用索引</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegment –files 00000000000052368601.index –index-sanity-check</p>
</blockquote>
<p>解析索引文件，并检查索引匹配度，但是不打印所有的索引</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-run-class.sh kafka.tools.DumpLogSegment –files 00000000000052368601.index –verity-index-only</p>
</blockquote>
<h3 id="控制台生产者消费者"><a href="#控制台生产者消费者" class="headerlink" title="控制台生产者消费者"></a>控制台生产者消费者</h3><p>黑白名单</p>
<blockquote>
<p>kafka-console-consumer.sh –zookeeper localhost:2181 –whitelist 正则表达式<br>kafka-console-consumer.sh –zookeeper localhost:2181 –blacklist 正则表达式<br>kafka-console-consumer.sh –zookeeper localhost:2181 –topic <topic-name></p>
</blockquote>
<p>读取偏移量(表示我run不起来)</p>
<blockquote>
<p>kafka-console-consumer.sh –zookeeper localhost:2181 –topic __consumer_offsets –formatter ‘Kafka.coordinator.GroupMetadataManager$OffsetsMessageFormatter’ –max-messages 1</p>
</blockquote>
<h2 id="3、配置项详解"><a href="#3、配置项详解" class="headerlink" title="3、配置项详解"></a><strong>3、配置项详解</strong></h2><p>下面只是部分配置，并不是全部配置，kafka版本差异，配置的关键字有差别。但是其实很多时候都可以使用默认的配置的。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每个broker的标识符，默认值为0，在集群中需要保证唯一性</span></span><br><span class="line"><span class="attr">broker.id</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># 监听的服务，建议是PLAINTEXT://your.host.name:9092，名字://ip:port  ############如果是阿里云，这里配置的是内网ip############</span></span><br><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://localhost:9092</span></span><br><span class="line"><span class="comment"># 推荐给生产者消费者监听的服务，如果未设置，则采用listener所设置的，如果均为设置，则抛出 java.net.InetAddress.getCanonicalHostName()异常，############如果是阿里云，这里配置的是外网ip############</span></span><br><span class="line"><span class="attr">advertised.listeners</span>=<span class="string">PLAINTEXT://your.host.name:9092</span></span><br><span class="line"><span class="comment"># 监听的安全协议，默认配置如下，详情见说明书</span></span><br><span class="line"><span class="comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br><span class="line"><span class="comment"># 收发请求时所使用到的网络线程数</span></span><br><span class="line"><span class="attr">num.network.threads</span>=<span class="string">3</span></span><br><span class="line"><span class="comment"># 处理请求时所使用到的线程数，包括IO时使用的线程数，与num.recovery.threads.per.data.dir和log.dirs有关</span></span><br><span class="line"><span class="attr">num.io.threads</span>=<span class="string">8</span></span><br><span class="line"><span class="comment"># 发送缓存区大小，默认10k</span></span><br><span class="line"><span class="attr">socket.send.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="comment"># 接受缓存区大小，默认10k</span></span><br><span class="line"><span class="attr">socket.receive.buffer.bytes</span>=<span class="string">102400</span></span><br><span class="line"><span class="comment"># 接受的请求的最大值100M</span></span><br><span class="line"><span class="attr">socket.request.max.bytes</span>=<span class="string">104857600</span></span><br><span class="line"><span class="comment"># 数据的路径，多路径使用逗号分隔，配置多个，则尽可能的把同一分区的数据保存在同一路径下</span></span><br><span class="line"><span class="attr">log.dirs</span>=<span class="string">\logs</span></span><br><span class="line"><span class="comment"># 在恢复数据的时候，每个log.dirs所使用的线程数，增加这里的线程数可以增加并发操作，加快数据的恢复</span></span><br><span class="line"><span class="attr">num.recovery.threads.per.data.dir</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"># 新创建的topic包含的分数数量，默认是1</span></span><br><span class="line"><span class="attr">num.partitions</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">offsets.topic.replication.factor</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">transaction.state.log.replication.factor</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">transaction.state.log.min.isr</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 把数据从缓存再到硬盘之前，所允许接收到的最大的消息数目</span></span><br><span class="line"><span class="comment">#log.flush.interval.messages=10000</span></span><br><span class="line"><span class="comment"># 把数据从缓存再到硬盘之前，所允许数据保留的时间</span></span><br><span class="line"><span class="comment">#log.flush.interval.ms=1000</span></span><br><span class="line"><span class="comment"># kafka数据保留的时间，默认是168，即一周,作用级别是日志级别</span></span><br><span class="line"><span class="attr">log.retention.hours</span>=<span class="string">168</span></span><br><span class="line"><span class="comment"># 每个分区数据的最大容量，默认是1G，作用级别是日志级别</span></span><br><span class="line"><span class="attr">log.retention.bytes</span>=<span class="string">1073741824</span></span><br><span class="line"><span class="comment"># 日志片段大小，日志文件大小，log.dirs指向的日志，当日志大小达到配置值时，当前日志片段就会被关闭，一个新的日志片段就会被打开，默认是1G，一旦日志片段被关闭就还是等待过期</span></span><br><span class="line"><span class="attr">log.segment.bytes</span>=<span class="string">1073741824</span></span><br><span class="line"><span class="comment"># 日志片段检查是否可以被删除的时间间隔</span></span><br><span class="line"><span class="attr">log.retention.check.interval.ms</span>=<span class="string">300000</span></span><br><span class="line"><span class="comment"># zookeeper地址，多zookeeper地址使用分号分隔，完整的格式为hostname:port/path，其中path可选，指的是集群的chroot地址，未指定默认使用根路径，不存在则在启动时自动创建</span></span><br><span class="line"><span class="attr">zookeeper.connect</span>=<span class="string">localhost:2181</span></span><br><span class="line"><span class="comment"># zookeeper连接的超时时间</span></span><br><span class="line"><span class="attr">zookeeper.connection.timeout.ms</span>=<span class="string">6000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">group.initial.rebalance.delay.ms</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># 监听的端口号，使用1024以下的端口号需要root权限才能启动</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">9092</span></span><br><span class="line"><span class="comment"># 默认自动创建主题（生产者或者消费者读写数据的时候，如果主题不存在）默认是true</span></span><br><span class="line"><span class="attr">auto.create.topics.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 日志片段持续的时间，默认不配置，即不会根据时间开启新的日志片段</span></span><br><span class="line"><span class="attr">log.segment.hours</span> =<span class="string">168</span></span><br><span class="line"><span class="comment"># 当个消息压缩后的最大值，默认是1M</span></span><br><span class="line"><span class="attr">message.max.bytes</span>=<span class="string">1000000</span></span><br><span class="line"><span class="comment"># 主题级别的复制系数，默认为3，即复制的分区副本数量</span></span><br><span class="line"><span class="attr">default.replication.factor</span>=<span class="string">3</span></span><br><span class="line"><span class="comment"># 不完全的首领选举，默认为true。当首领副本不可用，且所有的副本均不同步时，也从不同步的副本中选举首领。</span></span><br><span class="line"><span class="attr">unclean.leader.election</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 最少同步副本。只有消息被写入这么多个副本才能算是写入成功。</span></span><br><span class="line"><span class="attr">min.insync.replicas</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>




<h2 id="4、kafka伪集群搭建"><a href="#4、kafka伪集群搭建" class="headerlink" title="4、kafka伪集群搭建"></a><strong>4、kafka伪集群搭建</strong></h2><p>kafka集群的搭建和zookeeper集群的搭建没有关系。kafka集群可以使用单点的zookeeper，也可以使用集群的zookeeper。</p>
<h3 id="集群的搭建"><a href="#集群的搭建" class="headerlink" title="集群的搭建"></a>集群的搭建</h3><p>这里在一台linux服务器上搭建3台kafka集群为例：<br>第一台kafka配置文件(<code>server.properties</code>)，这里大部分使用的是默认的配置，可以参照上文中的含义，建议不要直接替换，而是将对应的配置项修改为对应的值：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kafka集群中broker的唯一标识，多个broker需要不同的值</span></span><br><span class="line"><span class="attr">broker.id</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># 这里使用的是阿里云的服务器，这里配置为阿里云内网ip，如果在本机，可以直接使用127.0.0.1或者localhost</span></span><br><span class="line"><span class="comment"># 这里的配置项也可以拆分开host.name port等多个</span></span><br><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://内网ip:9092</span></span><br><span class="line"><span class="comment"># 这里使用的是阿里云的服务器，这里配置的是阿里云的公网IP，如果在本机，这里的配置项可以不配置。</span></span><br><span class="line"><span class="attr">advertised.listeners</span>=<span class="string">PLAINTEXT:/外网ip:9092</span></span><br><span class="line"><span class="attr">log.dirs</span>=<span class="string">/my/kafka/kafka-logs</span></span><br><span class="line"><span class="attr">zookeeper.connect</span>=<span class="string">localhost:2181</span></span><br><span class="line"><span class="attr">default.replication.factor</span>=<span class="string">3</span></span><br></pre></td></tr></table></figure>

<p>第二台(<code>server-1.properties</code>)</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">broker.id</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://内网ip:9093</span></span><br><span class="line"><span class="attr">advertised.listeners</span>=<span class="string">PLAINTEXT://外网ip:9093</span></span><br><span class="line"><span class="attr">log.dirs</span>=<span class="string">/my/kafka/kafka-logs-1</span></span><br><span class="line"><span class="attr">zookeeper.connect</span>=<span class="string">localhost:2181</span></span><br><span class="line"><span class="attr">default.replication.factor</span>=<span class="string">3</span></span><br></pre></td></tr></table></figure>

<p>第三台(<code>server-2.properties</code>)</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">broker.id</span>=<span class="string">2</span></span><br><span class="line"><span class="attr">listeners</span>=<span class="string">PLAINTEXT://内网ip:9094</span></span><br><span class="line"><span class="attr">advertised.listeners</span>=<span class="string">PLAINTEXT://外网ip:9094</span></span><br><span class="line"><span class="attr">log.dirs</span>=<span class="string">/my/kafka/kafka-logs-2</span></span><br><span class="line"><span class="attr">zookeeper.connect</span>=<span class="string">localhost:2181</span></span><br><span class="line"><span class="attr">default.replication.factor</span>=<span class="string">3</span></span><br></pre></td></tr></table></figure>

<p>然后分别启动三台kafka的broker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-server-start.sh --daemon ./config/server.properties</span><br><span class="line">./bin/kafka-server-start.sh --daemon ./config/server-1.properties</span><br><span class="line">./bin/kafka-server-start.sh --daemon ./config/server-2.properties</span><br></pre></td></tr></table></figure>

<p>如果本机启动kafka的内存不足，可以修改<code>kafka-server-start.sh</code>中的配置项，会java的应该都看的懂，这里不介绍。</p>
<h3 id="检查集群是否搭建起来"><a href="#检查集群是否搭建起来" class="headerlink" title="检查集群是否搭建起来"></a>检查集群是否搭建起来</h3><p>方法一：在zookeeper上查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 打开zookeeper的客户端</span><br><span class="line">./zkCli.sh</span><br><span class="line"># 查看brokers下启动了多少个节点</span><br><span class="line"># 得到结果[0,1,2]，分别为每个broker.id</span><br><span class="line">ls /brokers/ids</span><br><span class="line"># 查看brokers下有多少主题，得到的就是集群下所有的主题</span><br><span class="line">ls /brokers/topics</span><br></pre></td></tr></table></figure>

<p>方法二：使用kafka查看<br>按照我们现在启动kafka的配置，应该会给每个主题创建三个副本，所以我们创建一个主题来试试。<br>这里不适用<code>kafka-topics.sh</code>这个命令来创建主题，因为这么命令主题是要显式申明多少分区和副本的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用生产者创建主题，创建之后需要往主题里面写一点数据，要不然主题是不会创建的</span><br><span class="line">./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class="line"># 查看主题的信息，得到的结果</span><br><span class="line"># Topic:test	PartitionCount:1	ReplicationFactor:3 	Configs:</span><br><span class="line">#	Topic: test	Partition: 0	Leader: 0	Replicas: [0,1,2]	Isr: [0,1,2]</span><br><span class="line">./bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic test</span><br><span class="line"># 也可以去对应的目录看是否有对应的文件夹存在(log.dirs)</span><br></pre></td></tr></table></figure>

<p>方法三：使用kafka监控平台进行查看（kafka-manager）</p>
<h2 id="5、分区副本的增删移动"><a href="#5、分区副本的增删移动" class="headerlink" title="5、分区副本的增删移动"></a><strong>5、分区副本的增删移动</strong></h2><p>kafka的分区暂时不支持分区的删除，删除分区会一并删除分区的数据，导致数据的不一致性</p>
<h3 id="增加分区"><a href="#增加分区" class="headerlink" title="增加分区"></a>增加分区</h3><blockquote>
<p> bin&#x2F;kafka-topics.sh –zookeeper localhost:2181&#x2F;kafka –alter –topic topic-config –partitions 3</p>
</blockquote>
<h3 id="副本的增删"><a href="#副本的增删" class="headerlink" title="副本的增删"></a>副本的增删</h3><p>创建文件<code>reassign.json</code>如下，下面文件表示对test这个主题的操作，同时这个主题有两个分区（partition），为0和1，json文件的含义为把test主题0分区的副本移动到1,2这两个节点上，把分区1的副本移动到3,4节点上，replicas的长度也表示副本的个数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;partitions&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;:&quot;test&quot;,</span><br><span class="line">            &quot;partiton&quot;:0,</span><br><span class="line">            &quot;replicas&quot;:[1,2]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;:&quot;test&quot;,</span><br><span class="line">            &quot;partiton&quot;:1,</span><br><span class="line">            &quot;replicas&quot;:[3,4]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 执行json文件</span><br><span class="line">kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file reassign.json --execute</span><br><span class="line"># 查看执行情况</span><br><span class="line">kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file reassign.json --verify</span><br></pre></td></tr></table></figure>
<p>被删除的分区在文件夹中对应过的目录会被命名为类似<code>test-154844454sadf5as4d511f5d4g1dfsg65fd4s-delete</code>，这个文件夹不会被立马删除，但是也会被很快删除，基本上只要保证数据一致性之后这个文件夹就会被删除。</p>
<h3 id="手动删除副本"><a href="#手动删除副本" class="headerlink" title="手动删除副本"></a><strong>手动删除副本</strong></h3><p>(1 ）关闭集群里所有的broker。</br><br>(2）删除Zookeeper 路径&#x2F;brokers&#x2F;topics&#x2F;ffOPICNAME ，注意要先删除节点下的子节点。</br><br>(3）删除每个broker 的分区目录，这些目录的名字可能是TOPICNAME-NUM ，其中NUM 是指分区的ID 。</br><br>(4）重启所有的broker 。</br></p>
<h2 id="6、消费者再均衡"><a href="#6、消费者再均衡" class="headerlink" title="6、消费者再均衡"></a><strong>6、消费者再均衡</strong></h2><h3 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a><strong>触发条件</strong></h3><ul>
<li>消费者崩溃并确认死亡之后出发再均衡</li>
<li>消费者自杀，即消费者调用了close方法</li>
<li>新的消费者加入群组</li>
</ul>
<h3 id="7、记录offset"><a href="#7、记录offset" class="headerlink" title="7、记录offset"></a><strong>7、记录offset</strong></h3><p>消费者在消费数据的同时，往<code>__consumer_offsets-x</code>这个主题内写数据，记录每个分区的偏移量</p>
<h2 id="kafka主题删除"><a href="#kafka主题删除" class="headerlink" title="kafka主题删除"></a><strong>kafka主题删除</strong></h2><h3 id="删除某个主题"><a href="#删除某个主题" class="headerlink" title="删除某个主题"></a>删除某个主题</h3><p>配置文件中需要配置<code>delete.topic.enable=true</code>，默认为true</p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-topics.sh –alter –zookeeper localhost:2181 –partitions 11 –topic 主题名</p>
</blockquote>
<h3 id="清空kafka"><a href="#清空kafka" class="headerlink" title="清空kafka"></a>清空kafka</h3><p>第一步：停用kafka<br>第二步：清空kafka数据目录下的所有文件（可在配置文件的<code>log.dirs</code>查看）<br>第三步：清空主题在zookeeper上的注册。(包括但不限于cluster,controller,brokers,admin,isr_change_notification,log_dir_event_notification,controller_epoch,conusumer,lastest_produce _id_block,config)</p>
<h2 id="8、监控平台-kafka-manager"><a href="#8、监控平台-kafka-manager" class="headerlink" title="8、监控平台 kafka-manager"></a><strong>8、监控平台 kafka-manager</strong></h2><p><code>kafka-manager</code>使用<code>scala</code>写的，相关的操作可以参考github<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yahoo/kafka-manager">https://github.com/yahoo/kafka-manager</a></p>
<p>首先需要安装<code>sbt</code></p>
<blockquote>
<p>curl <a target="_blank" rel="noopener external nofollow noreferrer" href="https://bintray.com/sbt/rpm/rpm">https://bintray.com/sbt/rpm/rpm</a> &gt; bintray-sbt-rpm.repo<br>mv bintray-sbt-rpm.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;<br>yum install sbt</p>
</blockquote>
<p>然后从github上下载源码自己编译打包：</p>
<blockquote>
<p>git clone git:&#x2F;&#x2F;github.com&#x2F;yahoo&#x2F;kafka-manager.git<br>cd kafka-manager<br>sbt clean dist<br>cd target&#x2F;universal<br>unzip kafka-manager-1.3.3.21.zip<br>vim kafka-manager-1.3.0.4&#x2F;conf&#x2F;application.conf<br>替换<code>kafka-manager.zkhosts=$&#123;?ZK_HOSTS&#125;</code>zookeeper的路径</p>
</blockquote>
<p>启动<code>kafka-manager</code></p>
<blockquote>
<p>.&#x2F;bin&#x2F;kafka-manager<br>.&#x2F;bin&#x2F;kafka-manager -Dhttp.port&#x3D;8888<br>nohup .&#x2F;bin&#x2F;kafka-manager &amp;</p>
</blockquote>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a><strong>Tips</strong></h2><h3 id="额"><a href="#额" class="headerlink" title="额"></a>额</h3><p>1、一个主题可以包含多个分区，kafka无法保证整个主题的顺序，但是可以保证分区的顺序。</br><br>2、对主题的键生成散列值，由散列值计算消息对应的分区。</br><br>3、每个分区只能被一个消费者消费。</br><br>4、一个独立的kafka服务器被称之为broker，单个broker可以轻松处理数千个分区以及每秒百万级的消息量。</br><br>5、集群中，不同broker的相同主题的多个分区中，会有一个分区被选举出来，成为分区的首领。此处涉及到分区赋值。</br><br>6、kafka可以保留数据一段时间，或者指定大小的消息。可以配置消息淘汰算法。</br><br>7、kafka希望有自己的zookeeper，因为kafka对zookeeper的延迟和超时教敏感</br><br>8、Java中kafkaProduer的默认是自动重试的，重试很多次之后才会抛异常。</br><br>9、kafka的键可以指定消息到主题的哪个分区，意味着同一个键的消息可以保存在同一个分区。根据键散列值指定分区，由此可定，分区数目是不可以改变的，扩展性不好</br><br>10、最安全退出consumer的方法是调用<code>consumer.wakeup();</code>方法</br><br>11、kafka使用zookeeper的临时节点来选举控制器，并在节点加入集群或者退出集群的时候通知控制器。控制器负责在节点加入或者退出时进行分区首领的选举</br></p>
<h3 id="额额"><a href="#额额" class="headerlink" title="额额"></a>额额</h3><p>元数据请求：元数据缓存，每个broker上都存储这个主题对应的分区，即对应的分区的分区首领。每次请求之前都会经过这个元数据缓存，从而知道消息应该从哪个分区写入或者消费。从而避免了在分区副本上进行操作。</br><br>零复制技术，直接从文件缓存中把消息发送出去，kafka本身并没有对消息进行这个层明的缓存。<br>未被复制到分区副本的消息是不会被消费者读取的，只有完成了副本的备份，消费者消费才能获取到数据。</br><br>分区的复制和数据的存储———《kafka权威指南》P81<br>彻底清除一个键：给broker发送一个包含改键且值为null的消息，清理线程便会清理掉该键</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/post/33434/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="更新时间"></i>
              2018-11-01 19:37:00
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="标签"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/kafka/" title="kafka">
                        #kafka
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/post/60241/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8kafka"><span class="toc-text">1、安装启动kafka</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-text">2、命令行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%A2%98%E4%BF%A1%E6%81%AF"><span class="toc-text">主题信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E4%BF%A1%E6%81%AF%EF%BC%9A"><span class="toc-text">消费者信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E5%8F%98%E6%9B%B4%EF%BC%9A"><span class="toc-text">动态配置变更：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-text">解析日志文件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">控制台生产者消费者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3"><span class="toc-text">3、配置项详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81kafka%E4%BC%AA%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-text">4、kafka伪集群搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-text">集群的搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%9B%86%E7%BE%A4%E6%98%AF%E5%90%A6%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5"><span class="toc-text">检查集群是否搭建起来</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%86%E5%8C%BA%E5%89%AF%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0%E7%A7%BB%E5%8A%A8"><span class="toc-text">5、分区副本的增删移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%86%E5%8C%BA"><span class="toc-text">增加分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0"><span class="toc-text">副本的增删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%A0%E9%99%A4%E5%89%AF%E6%9C%AC"><span class="toc-text">手动删除副本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E5%86%8D%E5%9D%87%E8%A1%A1"><span class="toc-text">6、消费者再均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"><span class="toc-text">触发条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E8%AE%B0%E5%BD%95offset"><span class="toc-text">7、记录offset</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka%E4%B8%BB%E9%A2%98%E5%88%A0%E9%99%A4"><span class="toc-text">kafka主题删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%9F%90%E4%B8%AA%E4%B8%BB%E9%A2%98"><span class="toc-text">删除某个主题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%A9%BAkafka"><span class="toc-text">清空kafka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0-kafka-manager"><span class="toc-text">8、监控平台 kafka-manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tips"><span class="toc-text">Tips</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%9D"><span class="toc-text">额</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%9D%E9%A2%9D"><span class="toc-text">额额</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'yvNS5mz8aI97Agw7mfdvOwAr-9Nh9j0Va',
        appKey: 'j0wtAiNMv4vT5Ta9FE027oCV',
        placeholder: '请输入关键字... 留下你的脚步...',
        avatar: 'mp',
        lang: 'zh-CN'
      })
    }
  </script>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ncfl/blog_svr">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ncfl/blog_svr">Copyright © 2023 ncfl</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/">粤ICP备2023040658号</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
    <div class="footer-views">
      
      
      
      
    </div>
  
</div>
<script type="text/javascript" src="/js/click-love.js"></script>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)" rel="external nofollow noreferrer">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)" rel="external nofollow noreferrer">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)" rel="external nofollow noreferrer">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="请输入关键字...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)" rel="external nofollow noreferrer">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' rel="external nofollow noreferrer" target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)" rel="external nofollow noreferrer">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        

      </div>
    </div>
  
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body>
</html>
